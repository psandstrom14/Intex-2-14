<!--edit.ejs-->
<!--Paris Ward, Lucas Moraes, Joshua Ethington, Parker Sandstrom-->
<!--This page will display add forms, and allow CRUD (for managers) + Search Capabilities.-->
<!--This page will only be visible to users who are logged in.-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit <%= table_name %> - Ella Rises</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" type="image/x-icon" href="/logo.ico" />
</head>
<body>
    <!-- Skip Navigation Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <a href="/"><img src="/images/logo.png" alt="Ella Rises Logo"> ELLA RISES</a>
            </div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/performance">Performance</a></li>
                <li><a href="/calendar">Calendar</a></li>
                <li><a href="/donate_now">Donate Now</a></li>

                <% if (isLoggedIn && userId) { %>
                    <li><a href="/profile/<%= userId %>">Profile</a></li>
                <% } %>

                <% if (role === "admin") { %>
                    <li class="dropdown">
                        <span class="dropdown-toggle">
                            <a href="#" class="selected-nav">Pages ▾</a>
                        </span>
                        <ul class="dropdown-menu">
                            <li><a href="/users">Participants</a></li>
                            <li><a href="/participants">Participants</a></li>
                            <li><a href="/events">Events</a></li>
                            <li><a href="/event_registrations">Event Registrations</a></li>
                            <li><a href="/surveys">Surveys</a></li>
                            <li><a href="/milestones">Milestones</a></li>
                            <li><a href="/donations">Donations</a></li>
                        </ul>
                    </li>
                <% } %>

                <% if (isLoggedIn) { %>
                    <li><a href="/logout" class="login-btn">Logout</a></li>
                <% } else { %>
                    <li><a href="/login" class="login-btn">Login</a></li>
                <% } %>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero hero-compact">
        <div class="hero-content">
            <h1>Edit <%= table_name.charAt(0).toUpperCase() + table_name.slice(1, -1) %></h1>
            <p class="hero-subtitle">Fill in the details below to edit a record</p>
        </div>
    </section>

    <!--Main Content-->
    <main id="main-content">
    <div class="container">
        <div class="add-card">
            <!-- Edit-Participant Form -->
            <% if (table_name === "users") { %>
                <% 
                    // Use profile-specific route if coming from profile page
                    const formAction = (typeof fromProfile !== 'undefined' && fromProfile) 
                        ? `/profile-edit/users/${info.user_id}` 
                        : `/edit/users/${info.user_id}`;
                %>
                <form id="addForm" class="modern-form" action="<%= formAction %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Basic Information</h2>
                        <p class="section-description">Edit <%= info.participant_first_name %>'s personal details</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">First Name <span class="required">*</span></label>
                                <input type="text" class="form-input" name="participant_first_name" value="<%= info.participant_first_name || '' %>" required autofocus>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Last Name <span class="required">*</span></label>
                                <input type="text" class="form-input" name="participant_last_name" value="<%= info.participant_last_name || '' %>" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Username <span class="required">*</span></label>
                                <input type="text" class="form-input" name="participant_username" value="<%= info.participant_username || '' %>" required>
                                <span class="form-hint">Used for login</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Password <span class="required">*</span></label>
                                <input type="password" class="form-input" name="participant_password" value="<%= info.participant_password || '' %>" required>
                                <span class="form-hint">Minimum 8 characters</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Participant Role <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="participant_role" value="admin" 
                                            <%= info.participant_role === 'admin' ? 'checked' : '' %> required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Admin</strong>
                                        <small>Full access to all features</small>
                                    </span>
                                </label>
                        
                                <label class="radio-label">
                                    <input type="radio" name="participant_role" value="participant" 
                                            <%= info.participant_role === 'participant' ? 'checked' : '' %> required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Participant</strong>
                                        <small>Standard participant access</small>
                                    </span>
                                </label>
                        
                                <label class="radio-label">
                                    <input type="radio" name="participant_role" value="donor" 
                                            <%= info.participant_role === 'donor' ? 'checked' : '' %> required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Donor</strong>
                                        <small>Donor portal access</small>
                                    </span>
                                </label>
                            </div>
                        </div>                        
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Contact Details</h2>
                        <p class="section-description">How can we reach <%= info.participant_first_name %>?</p>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Phone Number <span class="required">*</span></label>
                                <input type="tel" class="form-input" name="participant_phone" value="<%= info.participant_phone || '' %>" required>
                                <span class="form-hint">10 digits, no formatting</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address <span class="required">*</span></label>
                                <input type="email" class="form-input" name="participant_email" value="<%= info.participant_email || '' %>" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Location & Background</h2>
                        <p class="section-description">Tell us more about the participant</p>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City <span class="required">*</span></label>
                            
                                <!-- Pre-fills with the participant's city -->
                                <input 
                                    list="cities" 
                                    class="form-input" 
                                    name="participant_city" 
                                    placeholder="Select or type city" 
                                    value="<%= info.participant_city || '' %>" 
                                    required
                                >
                            
                                <datalist id="cities">
                                    <option value="Bountiful">
                                    <option value="Draper">
                                    <option value="Layton">
                                    <option value="Lehi">
                                    <option value="Logan">
                                    <option value="Murray">
                                    <option value="Ogden">
                                    <option value="Orem">
                                    <option value="Pleasant Grove">
                                    <option value="Provo">
                                    <option value="Riverton">
                                    <option value="Salt Lake City">
                                    <option value="Sandy">
                                    <option value="Spanish Fork">
                                    <option value="St. George">
                                    <option value="Taylorsville">
                                    <option value="West Jordan">
                                    <option value="West Valley City">
                                </datalist>
                            </div>                            

                            <div class="form-group">
                                <label class="form-label">Zip Code <span class="required">*</span></label>
                                <input type="text" class="form-input" name="participant_zip" value="<%= info.participant_zip || '' %>" pattern="[0-9]{5}" maxlength="5" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">School or Employer</label>
                            <input type="text" class="form-input" name="participant_school_or_employer" value="<%= info.participant_school_or_employer || '' %>">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Date of Birth</label>
                            <input 
                                type="date" 
                                class="form-input" 
                                name="participant_dob" 
                                value="<%= info.participant_dob ? (info.participant_dob.toISOString ? info.participant_dob.toISOString().slice(0,10) : info.participant_dob.slice(0,10)) : '' %>">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Field of Interest</label>
                            <div class="radio-group radio-group-inline">
                                <label class="radio-label">
                                    <input type="radio" name="participant_field_of_interest" value="STEM" <%= info.participant_field_of_interest === 'STEM' ? 'checked' : '' %>>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text"><strong>STEM</strong></span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="participant_field_of_interest" value="Arts" <%= info.participant_field_of_interest === 'Arts' ? 'checked' : '' %>>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text"><strong>Arts</strong></span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="participant_field_of_interest" value="Both" <%= info.participant_field_of_interest === 'Both' ? 'checked' : '' %>>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text"><strong>Both</strong></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <% 
                            // Determine cancel link based on where we came from
                            const cancelLink = (typeof fromProfile !== 'undefined' && fromProfile) 
                                ? `/profile/${info.user_id}?tab=profile` 
                                : '/participants';
                        %>
                        <a href="<%= cancelLink %>" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Participant</button>
                    </div>
                </form>

            <!-- Edit-Event registration Form -->
            <% } else if (table_name === "event_registrations") { %>
                <form id="addForm" class="modern-form" action="/edit/event_registrations/<%= info.event_id %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Event Details</h2>
                        <p class="section-description">Basic information about the event</p>

                        <div class="form-group">
                            <label class="form-label">Event Name <span class="required">*</span></label>
                            <select class="form-select" name="event_type_id" id="eventSelect" value="<%= info.event_name || '' %>"required>
                        <option value="">Select an Event Type</option>
                        <% event_types.forEach(t => { %>
                            <option value="<%= t.event_type_id %>" 
                                <%= info && info.event_type_id == t.event_type_id ? "selected" : "" %>>
                                <%= t.event_name %>
                            </option>
                        <% }) %>
                    </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Location <span class="required">*</span></label>
                            <select class="form-select" name="event_location" id="locations" required>
                                <datalist id="">
                                <option value="">Select a location</option>
                                <option value="Ella Rises HQ" <%= info.event_location == "Ella Rises HQ" ? 'selected' : '' %>>Ella Rises HQ</option>
                                <option value="Virtual Zoom" <%= info.event_location == "Virtual Zoom" ? 'selected' : '' %>>Virtual Zoom</option>
                                <option value="Art Studio 2" <%= info.event_location == "Art Studio 2" ? 'selected' : '' %>>Art Studio 2</option>
                                <option value="Community Center Room A" <%= info.event_location == "Community Center Room A" ? 'selected' : '' %>>Community Center Room A</option>
                                <option value="Local Library" <%= info.event_location == "Local Library" ? 'selected' : '' %>>Local Library</option>
                                </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Event Capacity <span class="required">*</span></label>
                            <input 
                                type="number" 
                                class="form-input" 
                                name="event_capacity" 
                                placeholder="Maximum attendees" 
                                min="1" 
                                max="500" 
                                value="<%= info.event_capacity || '' %>"
                                required>
                            <span class="form-hint">Maximum number of participants</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Schedule</h2>
                        <p class="section-description">When will this event take place?</p>
                        
                        <div class="form-group">
                            <label class="form-label">Event Date <span class="required">*</span></label>
                            <input 
                                type="date" 
                                class="form-input" 
                                name="event_date" 
                                value="<%= info.event_date ? (info.event_date.toISOString ? info.event_date.toISOString().slice(0,10) : info.event_date.slice(0,10)) : '' %>" 
                                required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Start Time <span class="required">*</span></label>
                                <input 
                                    type="time" 
                                    class="form-input" 
                                    name="event_start_time" 
                                    id="startTime" 
                                    value="<%= info.event_start_time ? info.event_start_time.toString().slice(0,5) : '' %>"
                                    required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">End Time <span class="required">*</span></label>
                                <input 
                                    type="time" 
                                    class="form-input" 
                                    name="event_end_time" 
                                    id="endTime" 
                                    value="<%= info.event_end_time ? info.event_end_time.toString().slice(0,5) : '' %>"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Registration</h2>
                        <p class="section-description">Set the registration deadline</p>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Deadline Date <span class="required">*</span></label>
                                <input 
                                    type="date" 
                                    class="form-input" 
                                    name="registration_deadline_date" 
                                    value="<%= info.registration_deadline_date ? (info.registration_deadline_date.toISOString ? info.registration_deadline_date.toISOString().slice(0,10) : info.registration_deadline_date.slice(0,10)) : '' %>"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Deadline Time <span class="required">*</span></label>
                                <input 
                                    type="time" 
                                    class="form-input" 
                                    name="event_registration_deadline_time" 
                                    value="<%= info.registration_deadline_time ? info.registration_deadline_time.toString().slice(0,5) : '' %>"
                                    required>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <a href="/events" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Event</button>
                    </div>
                </form>

            <!-- Edit-Event_registration Form -->
            <% } else if (table_name === "event_registration") { %>
                <% 
                    const formActionReg = (typeof fromProfile !== 'undefined' && fromProfile) 
                        ? `/profile-edit/event_registrations/${info.event_registration_id}` 
                        : `/edit/event_registrations/${info.event_registration_id}`;
                %>
                <form id="addForm" class="modern-form" action="<%= formActionReg %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Participant Information</h2>
                        <p class="section-description">Who is this registration for?</p>

                        <div class="form-group">
                            <label class="form-label">Participant ID <span class="required">*</span></label>
                            <input 
                                type="number" 
                                class="form-input" 
                                name="user_id" 
                                placeholder="Enter participant ID" 
                                min="1"
                                value="<%= info.user_id || '' %>"
                                required>
                            <span class="form-hint">Must be an existing participant</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Event Selection</h2>
                        <p class="section-description">Select the event this registered for</p>

                        <div class="form-group">
                            <label class="form-label">Event Name <span class="required">*</span></label>
                            <select class="form-select" name="event_name" id="eventSelect" required>
                                    <option value="">Select an Event</option>
                                    <% events.forEach(e => { %>
                                        <option value="<%= e.event_name %>"><%= e.event_name %></option>
                                    <% }) %>
                                </select>

                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Event Date & Time <span class="required">*</span></label>
                            <select class="form-select" name="event_id" id="eventInstanceSelect" required>
                                <option value=""><%= info.event_id ? 'Select a Date/Time' : 'Select an event above first' %></option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Registration Status</h2>
                        <p class="section-description">Update the participant's attendance status</p>

                        <div class="form-group">
                            <label class="form-label">Status <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="registration_status" 
                                        value="registered" 
                                        id="regStatusSelect"
                                        <%= info.registration_status === 'registered' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Registered</strong>
                                        <small>Participant has registered</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="registration_status" 
                                        value="attended" 
                                        id="regStatusSelect"
                                        <%= info.registration_status === 'attended' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Attended</strong>
                                        <small>Participant was present</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="registration_status" 
                                        value="no-show"
                                        <%= info.registration_status === 'no-show' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>No-Show</strong>
                                        <small>Did not attend</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="registration_status" 
                                        value="cancelled"
                                        <%= info.registration_status === 'cancelled' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Cancelled</strong>
                                        <small>Registration cancelled</small>
                                    </span>
                                </label>
                            </div>
                            <input 
                                type="hidden" 
                                name="registration_attend_status" 
                                id="attendStatusHidden" 
                                value="<%= typeof info.registration_attend_status !== 'undefined' 
                                            ? info.registration_attend_status 
                                            : (info.registration_status === 'attended' ? 1 : 0) %>">
                        </div>
                    </div>

                    <div class="form-actions">
                        <% 
                            const cancelLinkReg = (typeof fromProfile !== 'undefined' && fromProfile) 
                                ? `/profile/${info.user_id}?tab=events` 
                                : '/event_registrations';
                        %>
                        <a href="<%= cancelLinkReg %>" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Event Registration</button>
                    </div>
                </form>

            <!-- Edit-milestones Form -->
            <% } else if (table_name === "milestones") { %>
                <% 
                    const formActionMile = (typeof fromProfile !== 'undefined' && fromProfile) 
                        ? `/profile-edit/milestones/${info.milestone_id}` 
                        : `/edit/milestones/${info.milestone_id}`;
                %>
                <form id="addForm" class="modern-form" action="<%= formActionMile %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Participant Information</h2>
                        <p class="section-description">Who achieved this milestone?</p>

                        <div class="form-group">
                            <label class="form-label">Participant ID <span class="required">*</span></label>
                            <input 
                                type="number" 
                                class="form-input" 
                                name="user_id" 
                                placeholder="Enter participant ID" 
                                min="1"
                                value="<%= info.user_id || '' %>"
                                required>
                            <span class="form-hint">Must be an existing participant</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Milestone Details</h2>
                        <p class="section-description">Describe the achievement</p>

                        <div class="form-group">
                            <label class="form-label">Milestone Title <span class="required">*</span></label>
                            <input 
                                type="text" 
                                class="form-input" 
                                name="milestone_title" 
                                placeholder="e.g., Graduated with BS in Computer Science" 
                                value="<%= info.milestone_title || '' %>"
                                required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Milestone Category <span class="required">*</span></label>
                            <div class="radio-group radio-group-inline">
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="secondary"
                                        <%= info.milestone_category === 'secondary' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Secondary</strong>
                                        <small>Middle school / High school</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="undergraduate"
                                        <%= info.milestone_category === 'undergraduate' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Undergraduate</strong>
                                        <small>AA, AS, AAS, BA, BS</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="graduate"
                                        <%= info.milestone_category === 'graduate' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Graduate</strong>
                                        <small>MS, MFA, MBA</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="professional"
                                        <%= info.milestone_category === 'professional' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Professional</strong>
                                        <small>Jobs, paid roles</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="enrichment"
                                        <%= info.milestone_category === 'enrichment' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Enrichment</strong>
                                        <small>Mentorships, awards, internships</small>
                                    </span>
                                </label>
                                <label class="radio-label">
                                    <input 
                                        type="radio" 
                                        name="milestone_category" 
                                        value="certificate"
                                        <%= info.milestone_category === 'certificate' ? 'checked' : '' %>
                                        required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">
                                        <strong>Certificate Programs</strong>
                                        <small>Any certificate program</small>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Milestone Date <span class="required">*</span></label>
                            <input 
                                type="date" 
                                class="form-input" 
                                name="milestone_date"
                                value="<%= info.milestone_date ? (info.milestone_date.toISOString ? info.milestone_date.toISOString().slice(0,10) : info.milestone_date.slice(0,10)) : '' %>"
                                required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <% 
                            const cancelLinkMile = (typeof fromProfile !== 'undefined' && fromProfile) 
                                ? `/profile/${info.user_id}?tab=milestones` 
                                : '/milestones';
                        %>
                        <a href="<%= cancelLinkMile %>" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Milestone</button>
                    </div>
                </form>

            <!-- Edit Donations Form -->
            <% } else if (table_name === "donations") { %>
                <% 
                    const formActionDon = (typeof fromProfile !== 'undefined' && fromProfile) 
                        ? `/profile-edit/donations/${info.donation_id}` 
                        : `/edit/donations/${info.donation_id}`;
                %>
                <form id="addForm" class="modern-form" action="<%= formActionDon %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Donor Information</h2>
                        <p class="section-description">Who made this donation?</p>

                        <div class="form-group">
                            <label class="form-label">Participant ID <span class="required">*</span></label>
                            <input 
                                type="number" 
                                class="form-input" 
                                name="user_id" 
                                placeholder="Enter participant ID" 
                                min="1"
                                value="<%= info.user_id || '' %>"
                                required>
                            <span class="form-hint">Must be an existing participant</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Donation Details</h2>
                        <p class="section-description">Record the donation information</p>

                        <div class="form-group">
                            <label class="form-label">Donation Date <span class="required">*</span></label>
                            <input 
                                type="date" 
                                class="form-input" 
                                name="donation_date"
                                value="<%= info.donation_date ? (info.donation_date.toISOString ? info.donation_date.toISOString().slice(0,10) : info.donation_date.slice(0,10)) : '' %>"
                                required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Donation Amount <span class="required">*</span></label>
                            <div class="input-with-prefix">
                                <span class="input-prefix">$</span>
                                <input 
                                    type="number" 
                                    class="form-input form-input-with-prefix" 
                                    name="donation_amount" 
                                    placeholder="0.00" 
                                    min="0.01" 
                                    step="0.01"
                                    value="<%= info.donation_amount || '' %>"
                                    required>
                            </div>
                            <span class="form-hint">Enter amount in USD</span>
                        </div>
                    </div>

                    <div class="form-actions">
                        <% 
                            const cancelLinkDon = (typeof fromProfile !== 'undefined' && fromProfile) 
                                ? `/profile/${info.user_id}?tab=donations` 
                                : '/donations';
                        %>
                        <a href="<%= cancelLinkDon %>" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Donation</button>
                    </div>
                </form>
            <% } else if (table_name === "survey_results") { %>
                <% 
                    const formActionSurvey = (typeof fromProfile !== 'undefined' && fromProfile) 
                        ? `/profile-edit/survey_results/${info.survey_id}` 
                        : `/edit/survey_results/${info.survey_id}`;
                %>
                <form id="addForm" class="modern-form" action="<%= formActionSurvey %>" method="POST">
                    
                    <div class="form-section">
                        <h2 class="section-title">Participant Information</h2>
                        <p class="section-description">Who is this survey for?</p>
                        <div class="form-group">
                            <label class="form-label">Participant ID <span class="required">*</span></label>
                            <input 
                                type="number" 
                                class="form-input" 
                                name="user_id" 
                                value="<%= info.user_id || '' %>"
                                min="1" 
                                required>
                            <span class="form-hint">Must be an existing participant</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Event Selection</h2>
                        <p class="section-description">Select the event this survey is for</p>

                        <div class="form-group">
                            <label class="form-label">Event Name <span class="required">*</span></label>
                            <select class="form-select" name="event_name" id="eventSelect" required>
                                <option value="">Select an Event</option>
                                <% events.forEach(ev => { %>
                                    <option value="<%= ev.event_name %>" <%= info.event_name === ev.event_name ? 'selected' : '' %>>
                                        <%= ev.event_name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Event Date & Time <span class="required">*</span></label>
                            <select class="form-select" name="event_id" id="eventInstanceSelect" required>
                                <option value="">Select an Event</option>
                                <% events.forEach(ev => { %>
                                    <option value="<%= ev.event_id %>" <%= info.event_id == ev.event_id ? 'selected' : '' %>>
                                        <%= ev.event_date %> <% if (ev.event_start_time && ev.event_end_time) { %>(<%= ev.event_start_time %>–<%= ev.event_end_time %>)<% } else if (ev.event_start_time) { %>(<%= ev.event_start_time %>)<% } %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">Survey Questions</h2>
                        <p class="section-description">We would love to know how you felt about this event!</p>
                        <p class="section-description">Please rank how you felt (on a scale of 0-5)</p>

                        <!-- Survey: Satisfaction -->
                        <div class="form-group">
                            <label class="form-label">I felt satisfied with this event. <span class="required">*</span></label>
                            <div class="radio-group">
                                <% for (let i = 0; i <= 5; i++) { %>
                                    <label class="radio-label">
                                        <input 
                                            type="radio" 
                                            name="survey_satisfaction_score" 
                                            value="<%= i %>" 
                                            <%= info.survey_satisfaction_score == i ? 'checked' : '' %>
                                            required>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">
                                            <strong><%= i %></strong>
                                            <% if (i === 0) { %><small>Strongly disagree</small><% } %>
                                            <% if (i === 5) { %><small>Strongly agree</small><% } %>
                                        </span>
                                    </label>
                                <% } %>
                            </div>
                        </div>

                        <!-- Survey: Usefulness -->
                        <div class="form-group">
                            <label class="form-label">This event was extremely helpful. <span class="required">*</span></label>
                            <div class="radio-group">
                                <% for (let i = 0; i <= 5; i++) { %>
                                    <label class="radio-label">
                                        <input 
                                            type="radio" 
                                            name="survey_usefulness_score" 
                                            value="<%= i %>" 
                                            <%= info.survey_usefulness_score == i ? 'checked' : '' %>
                                            required>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">
                                            <strong><%= i %></strong>
                                            <% if (i === 0) { %><small>Strongly disagree</small><% } %>
                                            <% if (i === 5) { %><small>Strongly agree</small><% } %>
                                        </span>
                                    </label>
                                <% } %>
                            </div>
                        </div>

                        <!-- Survey: Instructor -->
                        <div class="form-group">
                            <label class="form-label">The event instructor was extremely helpful. <span class="required">*</span></label>
                            <div class="radio-group">
                                <% for (let i = 0; i <= 5; i++) { %>
                                    <label class="radio-label">
                                        <input 
                                            type="radio" 
                                            name="survey_instructor_score" 
                                            value="<%= i %>" 
                                            <%= info.survey_instructor_score == i ? 'checked' : '' %>
                                            required>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">
                                            <strong><%= i %></strong>
                                            <% if (i === 0) { %><small>Strongly disagree</small><% } %>
                                            <% if (i === 5) { %><small>Strongly agree</small><% } %>
                                        </span>
                                    </label>
                                <% } %>
                            </div>
                        </div>

                        <!-- Survey: Recommendation -->
                        <div class="form-group">
                            <label class="form-label">I would recommend this event to family and friends. <span class="required">*</span></label>
                            <div class="radio-group">
                                <% for (let i = 0; i <= 5; i++) { %>
                                    <label class="radio-label">
                                        <input 
                                            type="radio" 
                                            name="survey_recommendation_score" 
                                            value="<%= i %>" 
                                            <%= info.survey_recommendation_score == i ? 'checked' : '' %>
                                            required>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">
                                            <strong><%= i %></strong>
                                            <% if (i === 0) { %><small>Strongly disagree</small><% } %>
                                            <% if (i === 5) { %><small>Strongly agree</small><% } %>
                                        </span>
                                    </label>
                                <% } %>
                            </div>
                        </div>

                        <!-- Survey: Overall -->
                        <div class="form-group">
                            <label class="form-label">Overall, I really enjoyed and appreciated this event. <span class="required">*</span></label>
                            <div class="radio-group">
                                <% for (let i = 0; i <= 5; i++) { %>
                                    <label class="radio-label">
                                        <input 
                                            type="radio" 
                                            name="survey_overall_score" 
                                            value="<%= i %>" 
                                            <%= info.survey_overall_score == i ? 'checked' : '' %>
                                            required>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">
                                            <strong><%= i %></strong>
                                            <% if (i === 0) { %><small>Strongly disagree</small><% } %>
                                            <% if (i === 5) { %><small>Strongly agree</small><% } %>
                                        </span>
                                    </label>
                                <% } %>
                            </div>
                        </div>

                        <!-- Comments -->
                        <div class="form-group">
                            <label class="form-label" for="survey_comments">Additional comments</label>
                            <textarea
                                id="survey_comments"
                                name="survey_comments"
                                class="form-control"
                                rows="4"
                                placeholder="Share any thoughts or suggestions about this event..."
                            ><%= info.survey_comments || '' %></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <% 
                            const cancelLinkSurvey = (typeof fromProfile !== 'undefined' && fromProfile) 
                                ? `/profile/${info.user_id}?tab=surveys` 
                                : '/surveys';
                        %>
                        <a href="<%= cancelLinkSurvey %>" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Edit Survey</button>
                    </div>
                </form>

            <% } else { %>
                <div class="empty-state">
                    <h2>No Form Available</h2>
                    <p>The requested form type is not available.</p>
                    <a href="/" class="btn btn-primary">Return Home</a>
                </div>
            <% } %>
        </div>
    </div>
    </main>

    <!--Footer-->
    <footer>
        <p>&copy; 2025 Ella Rises. All Rights Reserved.</p>
        <p class="footer-subtext">Making a difference, one woman at a time.</p>

        <div class="custom-language-selector">
            <button class="language-dropdown-btn" onclick="toggleLanguageDropdown()">
                <span id="currentLanguage">
                    <% if (language === 'es') { %>🌐 Español
                    <% } else if (language === 'fr') { %>🌐 Français
                    <% } else if (language === 'de') { %>🌐 Deutsch
                    <% } else if (language === 'pt') { %>🌐 Português
                    <% } else if (language === 'ar') { %>🌐 العربية
                    <% } else if (language === 'zh-CN') { %>🌐 中文
                    <% } else if (language === 'ja') { %>🌐 日本語
                    <% } else if (language === 'ko') { %>🌐 한국어
                    <% } else { %>🌐 English <% } %>
                </span>
                <span class="dropdown-arrow">▾</span>
            </button>
            <div class="language-dropdown-menu" id="languageDropdown">
                <a href="#" onclick="changeLanguage('en'); return false;">English</a>
                <a href="#" onclick="changeLanguage('es'); return false;">Español</a>
                <a href="#" onclick="changeLanguage('fr'); return false;">Français</a>
                <a href="#" onclick="changeLanguage('de'); return false;">Deutsch</a>
                <a href="#" onclick="changeLanguage('pt'); return false;">Português</a>
                <a href="#" onclick="changeLanguage('ar'); return false;">العربية</a>
                <a href="#" onclick="changeLanguage('zh-CN'); return false;">中文</a>
                <a href="#" onclick="changeLanguage('ja'); return false;">日本語</a>
                <a href="#" onclick="changeLanguage('ko'); return false;">한국어</a>
            </div>
        </div>

        <div id="google_translate_element" style="display:none;"></div>

        <script>
            const LANGUAGE_NAMES = {
                'en': '🌐 English',
                'es': '🌐 Español',
                'fr': '🌐 Français',
                'de': '🌐 Deutsch',
                'pt': '🌐 Português',
                'ar': '🌐 العربية',
                'zh-CN': '🌐 中文',
                'ja': '🌐 日本語',
                'ko': '🌐 한국어'
            };

            // From server-side session (res.locals.language)
            const SESSION_LANGUAGE = '<%= language || "en" %>';

            // Initialize Google Translate widget – no extra logic here
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({
                    pageLanguage: 'en',
                    includedLanguages: 'en,es,fr,de,pt,ar,zh-CN,ja,ko',
                    autoDisplay: false
                }, 'google_translate_element');
            }

            function getGoogTransLang() {
                // Looks for cookie like: googtrans=/auto/es
                const match = document.cookie.match(/(?:^|;)\s*googtrans=\/auto\/([^;]+)/);
                return match ? match[1] : null;
            }

            function setLanguageLabel(lang) {
                const el = document.getElementById('currentLanguage');
                if (!el) return;
                el.textContent = LANGUAGE_NAMES[lang] || LANGUAGE_NAMES['en'];
            }

            function applyLanguage(lang, isInit) {
                const combo = document.querySelector('.goog-te-combo');
                if (!combo) {
                    // Wait for Google widget to finish rendering
                    setTimeout(() => applyLanguage(lang, isInit), 200);
                    return;
                }

                combo.value = lang;
                combo.dispatchEvent(new Event('change'));
                setLanguageLabel(lang);

                if (!isInit) {
                    // Persist to your session on the server
                    fetch('/set-language', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lang })
                    }).catch(() => {});
                    // Optional: localStorage helper if you want it
                    localStorage.setItem('selectedLanguage', lang);
                    toggleLanguageDropdown(false);
                }
            }

            function changeLanguage(lang) {
                applyLanguage(lang, false);
            }

            function toggleLanguageDropdown(forceClose) {
                const dropdown = document.getElementById('languageDropdown');
                if (!dropdown) return;
                if (forceClose === false) {
                    dropdown.classList.remove('show');
                } else {
                    dropdown.classList.toggle('show');
                }
            }

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.custom-language-selector')) {
                    toggleLanguageDropdown(false);
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                // Make sure the label matches whatever we think the language is
                setLanguageLabel(SESSION_LANGUAGE);

                const cookieLang = getGoogTransLang();
                const storedLang = localStorage.getItem('selectedLanguage');

                // Priority: Google cookie > session > localStorage
                const preferred =
                    cookieLang ||
                    (SESSION_LANGUAGE && SESSION_LANGUAGE !== 'undefined' ? SESSION_LANGUAGE : null) ||
                    storedLang ||
                    'en';

                // If preferred is English, just leave as-is (no translate flicker)
                if (preferred === 'en') {
                    setLanguageLabel('en');
                    return;
                }

                // Apply preferred language once widget is ready
                setTimeout(() => applyLanguage(preferred, true), 500);
            });
        </script>

        <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    </footer>


    <script>
        const currentTable = "<%= table_name %>";

        // ---------------- NAV DROPDOWN ----------------
        let dropdownTimeout;
        const dropdown = document.querySelector('.dropdown');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        if (dropdown && dropdownMenu) {
            dropdown.addEventListener('mouseenter', function() {
                clearTimeout(dropdownTimeout);
                dropdownMenu.style.display = 'block';
            });

            dropdown.addEventListener('mouseleave', function() {
                dropdownTimeout = setTimeout(function() {
                    dropdownMenu.style.display = 'none';
                }, 200);
            });

            dropdownMenu.addEventListener('mouseenter', function() {
                clearTimeout(dropdownTimeout);
                dropdownMenu.style.display = 'block';
            });

            dropdownMenu.addEventListener('mouseleave', function() {
                dropdownTimeout = setTimeout(function() {
                    dropdownMenu.style.display = 'none';
                }, 200);
            });
        }

        // ---------------- EVENTS PAGE JS ----------------
        if (currentTable === "events") {
            const select = document.getElementById('eventSelect');
            const eventNameInput = document.getElementById('eventNameInput');

            if (select && eventNameInput) {
                // Set initial hidden value based on selected option (for edit)
                if (!eventNameInput.value && select.selectedIndex > 0) {
                    eventNameInput.value = select.options[select.selectedIndex].text;
                }

                select.addEventListener('change', () => {
                    const selectedOption = select.options[select.selectedIndex];
                    eventNameInput.value = selectedOption.text;
                });
            }

            const startTimeInput = document.getElementById("startTime");
            const endTimeInput = document.getElementById("endTime");

            if (startTimeInput && endTimeInput) {
                startTimeInput.addEventListener("change", () => {
                    const startValue = startTimeInput.value;
                    endTimeInput.min = startValue;
                    if (endTimeInput.value < startValue) {
                        endTimeInput.value = "";
                    }
                });

                endTimeInput.addEventListener("change", () => {
                    if (endTimeInput.value < startTimeInput.value) {
                        alert("End time cannot be earlier than start time.");
                        endTimeInput.value = "";
                    }
                });
            }
        }

        // ---------------- SURVEYS PAGE JS ----------------
        if (currentTable === "survey_results") {
            const existingSurvey = <%- JSON.stringify(info || {}) %>;
            const allEvents = <%- JSON.stringify(typeof events !== 'undefined' ? (events || []) : []) %>;

            const regInputs = document.querySelectorAll('input[name="registration_status"]');
            const hiddenAttend = document.getElementById("attendStatusHidden");

            if (regInputs && hiddenAttend) {
                regInputs.forEach(input => {
                    // Pre-select based on existing status
                    if (existingSurvey.registration_status && input.value === existingSurvey.registration_status) {
                        input.checked = true;
                        hiddenAttend.value = (existingSurvey.registration_status === "attended") ? 1 : 0;
                    }

                    input.addEventListener("change", () => {
                        hiddenAttend.value = (input.value === "attended") ? 1 : 0;
                    });
                });

                if (!hiddenAttend.value && existingSurvey.registration_status) {
                    hiddenAttend.value = (existingSurvey.registration_status === "attended") ? 1 : 0;
                }
            }

            const eventSelectSurvey = document.getElementById("eventSelect");
            const eventInstanceSelect = document.getElementById("eventInstanceSelect");

            function formatEventOption(ev) {
                let label = ev.event_date;
                if (ev.event_start_time && ev.event_end_time) {
                    label += ` (${ev.event_start_time}–${ev.event_end_time})`;
                } else if (ev.event_start_time) {
                    label += ` (${ev.event_start_time})`;
                }
                return label;
            }

            function populateEventInstances(selectedName, preselectedId) {
                eventInstanceSelect.innerHTML = "";
                eventInstanceSelect.disabled = true;

                if (!selectedName) {
                    const opt = document.createElement("option");
                    opt.value = "";
                    opt.textContent = "Select an event above first";
                    eventInstanceSelect.appendChild(opt);
                    return;
                }

                const matchingEvents = allEvents.filter(ev => ev.event_name === selectedName);

                if (matchingEvents.length === 0) {
                    const opt = document.createElement("option");
                    opt.value = "";
                    opt.textContent = "No dates found for this event";
                    eventInstanceSelect.appendChild(opt);
                    return;
                }

                const defaultOpt = document.createElement("option");
                defaultOpt.value = "";
                defaultOpt.textContent = "Select a Date/Time";
                eventInstanceSelect.appendChild(defaultOpt);

                matchingEvents.forEach(ev => {
                    const opt = document.createElement("option");
                    opt.value = ev.event_id;
                    opt.textContent = formatEventOption(ev);
                    if (preselectedId && String(preselectedId) === String(ev.event_id)) {
                        opt.selected = true;
                    }
                    eventInstanceSelect.appendChild(opt);
                });

                eventInstanceSelect.disabled = false;
            }

            if (eventSelectSurvey && eventInstanceSelect) {
                // Pre-select existing event + instance on edit
                if (existingSurvey.event_name) {
                    eventSelectSurvey.value = existingSurvey.event_name;
                    populateEventInstances(existingSurvey.event_name, existingSurvey.event_id);
                }

                eventSelectSurvey.addEventListener("change", () => {
                    const selectedName = eventSelectSurvey.value;
                    populateEventInstances(selectedName, null);
                });
            }
        }

        // ---------------- FORM ANIMATIONS ----------------
        const formInputs = document.querySelectorAll('.form-input, .form-select');
        formInputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
            });
            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('focused');
            });
        });
    </script>
</body>
</html>
