<!--Paris Ward, Lucas Moraes, Joshua Ethington, Parker Sandstrom-->
<!--This page will allow managers and users to log in to view the databases-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Ella Rises</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="icon" type="image/x-icon" href="/logo.ico" />
  </head>
  <body>
    <!-- Skip Navigation Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav>
      <div class="nav-container">
          <div class="logo">
              <a href="/"><img src="/images/logo.png" alt="Ella Rises Logo"> ELLA RISES</a>
          </div>
          <ul class="nav-links">
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/performance">Performance</a></li>
              <li><a href="/calendar">Calendar</a></li>
              <li><a href="/donate_now">Donate Now</a></li>

              <% if (isLoggedIn && userId) { %>
                  <li><a href="/profile/<%= userId %>">Profile</a></li>
              <% } %>

              <% if (role === "admin") { %>
                  <li class="dropdown">
                      <span class="dropdown-toggle">
                          <a href="#">Pages â–¾</a>
                      </span>
                      <ul class="dropdown-menu">
                          <li><a href="/users">Users</a></li>
                          <li><a href="/participants">Participants</a></li>
                          <li><a href="/events">Events</a></li>
                          <li><a href="/event_registrations">Event Registrations</a></li>
                          <li><a href="/surveys">Surveys</a></li>
                          <li><a href="/milestones">Milestones</a></li>
                          <li><a href="/donations">Donations</a></li>
                      </ul>
                  </li>
              <% } %>

              <% if (isLoggedIn) { %>
                  <li><a href="/logout" class="login-btn">Logout</a></li>
              <% } else { %>
                  <li><a href="/login" class="login-btn">Login</a></li>
              <% } %>
          </ul>
      </div>
  </nav>

    <!-- Hero Section -->
    <section class="hero hero-compact login-hero">
      <div class="hero-content">
        <h1>Welcome</h1>
        <p class="hero-subtitle">Sign in to access your account</p>
      </div>
    </section>

    <!-- Add error message display here -->
    <% if (typeof error_message !== 'undefined' && error_message) { %>
    <div class="container login-error-container">
      <div class="alert alert-danger"><%= error_message %></div>
    </div>
    <% } %>

    <!-- Login Form -->
    <main id="main-content">
    <div class="container">
      <div class="add-card compact">
        <form class="modern-form" method="POST" action="/login">
          <div class="form-section no-border">
            <div class="form-group">
              <label class="form-label" for="username"
                >Username<span class="required">*</span></label
              >
              <input
                type="text"
                class="form-input"
                id="username"
                name="username"
                placeholder="Enter your username"
                required
                autofocus
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="password"
                >Password <span class="required">*</span></label
              >
              <input
                type="password"
                class="form-input"
                id="password"
                name="password"
                placeholder="Enter your password"
                required
              />
            </div>
          </div>

          <div class="form-actions compact">
            <button type="submit" class="btn btn-primary btn-block">
              Sign In
            </button>
            <a href="/signup" class="btn btn-secondary btn-block">
              Create New Account
            </a>
          </div>
        </form>
      </div>
    </div>
    </main>

        <!--Footer-->
        <footer>
          <p>&copy; 2025 Ella Rises. All Rights Reserved.</p>
          <p class="footer-subtext">Making a difference, one woman at a time.</p>
  
          <div class="custom-language-selector">
              <button class="language-dropdown-btn" onclick="toggleLanguageDropdown()">
                  <span id="currentLanguage">
                      <% if (language === 'es') { %>ğŸŒ EspaÃ±ol
                      <% } else if (language === 'fr') { %>ğŸŒ FranÃ§ais
                      <% } else if (language === 'de') { %>ğŸŒ Deutsch
                      <% } else if (language === 'pt') { %>ğŸŒ PortuguÃªs
                      <% } else if (language === 'ar') { %>ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                      <% } else if (language === 'zh-CN') { %>ğŸŒ ä¸­æ–‡
                      <% } else if (language === 'ja') { %>ğŸŒ æ—¥æœ¬èª
                      <% } else if (language === 'ko') { %>ğŸŒ í•œêµ­ì–´
                      <% } else { %>ğŸŒ English <% } %>
                  </span>
                  <span class="dropdown-arrow">â–¾</span>
              </button>
              <div class="language-dropdown-menu" id="languageDropdown">
                  <a href="#" onclick="changeLanguage('en'); return false;">English</a>
                  <a href="#" onclick="changeLanguage('es'); return false;">EspaÃ±ol</a>
                  <a href="#" onclick="changeLanguage('fr'); return false;">FranÃ§ais</a>
                  <a href="#" onclick="changeLanguage('de'); return false;">Deutsch</a>
                  <a href="#" onclick="changeLanguage('pt'); return false;">PortuguÃªs</a>
                  <a href="#" onclick="changeLanguage('ar'); return false;">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a>
                  <a href="#" onclick="changeLanguage('zh-CN'); return false;">ä¸­æ–‡</a>
                  <a href="#" onclick="changeLanguage('ja'); return false;">æ—¥æœ¬èª</a>
                  <a href="#" onclick="changeLanguage('ko'); return false;">í•œêµ­ì–´</a>
              </div>
          </div>
  
          <div id="google_translate_element" style="display:none;"></div>
  
          <script>
              const LANGUAGE_NAMES = {
                  'en': 'ğŸŒ English',
                  'es': 'ğŸŒ EspaÃ±ol',
                  'fr': 'ğŸŒ FranÃ§ais',
                  'de': 'ğŸŒ Deutsch',
                  'pt': 'ğŸŒ PortuguÃªs',
                  'ar': 'ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
                  'zh-CN': 'ğŸŒ ä¸­æ–‡',
                  'ja': 'ğŸŒ æ—¥æœ¬èª',
                  'ko': 'ğŸŒ í•œêµ­ì–´'
              };
  
              // From server-side session (res.locals.language)
              const SESSION_LANGUAGE = '<%= language || "en" %>';
  
              // Initialize Google Translate widget â€“ no extra logic here
              function googleTranslateElementInit() {
                  new google.translate.TranslateElement({
                      pageLanguage: 'en',
                      includedLanguages: 'en,es,fr,de,pt,ar,zh-CN,ja,ko',
                      autoDisplay: false
                  }, 'google_translate_element');
              }
  
              function getGoogTransLang() {
                  // Looks for cookie like: googtrans=/auto/es
                  const match = document.cookie.match(/(?:^|;)\s*googtrans=\/auto\/([^;]+)/);
                  return match ? match[1] : null;
              }
  
              function setLanguageLabel(lang) {
                  const el = document.getElementById('currentLanguage');
                  if (!el) return;
                  el.textContent = LANGUAGE_NAMES[lang] || LANGUAGE_NAMES['en'];
              }
  
              function applyLanguage(lang, isInit) {
                  const combo = document.querySelector('.goog-te-combo');
                  if (!combo) {
                      // Wait for Google widget to finish rendering
                      setTimeout(() => applyLanguage(lang, isInit), 200);
                      return;
                  }
  
                  combo.value = lang;
                  combo.dispatchEvent(new Event('change'));
                  setLanguageLabel(lang);
  
                  if (!isInit) {
                      // Persist to your session on the server
                      fetch('/set-language', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ lang })
                      }).catch(() => {});
                      // Optional: localStorage helper if you want it
                      localStorage.setItem('selectedLanguage', lang);
                      toggleLanguageDropdown(false);
                  }
              }
  
              function changeLanguage(lang) {
                  applyLanguage(lang, false);
              }
  
              function toggleLanguageDropdown(forceClose) {
                  const dropdown = document.getElementById('languageDropdown');
                  if (!dropdown) return;
                  if (forceClose === false) {
                      dropdown.classList.remove('show');
                  } else {
                      dropdown.classList.toggle('show');
                  }
              }
  
              document.addEventListener('click', (e) => {
                  if (!e.target.closest('.custom-language-selector')) {
                      toggleLanguageDropdown(false);
                  }
              });
  
              document.addEventListener('DOMContentLoaded', () => {
                  // Make sure the label matches whatever we think the language is
                  setLanguageLabel(SESSION_LANGUAGE);
  
                  const cookieLang = getGoogTransLang();
                  const storedLang = localStorage.getItem('selectedLanguage');
  
                  // Priority: Google cookie > session > localStorage
                  const preferred =
                      cookieLang ||
                      (SESSION_LANGUAGE && SESSION_LANGUAGE !== 'undefined' ? SESSION_LANGUAGE : null) ||
                      storedLang ||
                      'en';
  
                  // If preferred is English, just leave as-is (no translate flicker)
                  if (preferred === 'en') {
                      setLanguageLabel('en');
                      return;
                  }
  
                  // Apply preferred language once widget is ready
                  setTimeout(() => applyLanguage(preferred, true), 500);
              });
          </script>
  
          <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
      </footer>
  
    <script>
      // Allow Dropdown to handle delay to increase usability
      let dropdownTimeout;
      const dropdown = document.querySelector(".dropdown");
      const dropdownMenu = document.querySelector(".dropdown-menu");

      if (dropdown && dropdownMenu) {
        dropdown.addEventListener("mouseenter", function () {
          clearTimeout(dropdownTimeout);
          dropdownMenu.style.display = "block";
        });

        dropdown.addEventListener("mouseleave", function () {
          dropdownTimeout = setTimeout(function () {
            dropdownMenu.style.display = "none";
          }, 200); // 200ms delay before closing
        });

        dropdownMenu.addEventListener("mouseenter", function () {
          clearTimeout(dropdownTimeout);
          dropdownMenu.style.display = "block";
        });

        dropdownMenu.addEventListener("mouseleave", function () {
          dropdownTimeout = setTimeout(function () {
            dropdownMenu.style.display = "none";
          }, 200);
        });
      }

      // Add focus effects to form inputs
      const formInputs = document.querySelectorAll(".form-input");
      formInputs.forEach((input) => {
        const formGroup = input.closest(".form-group");

        input.addEventListener("focus", function () {
          formGroup.classList.add("focused");
        });

        input.addEventListener("blur", function () {
          formGroup.classList.remove("focused");
        });
      });
    </script>
  </body>
</html>
