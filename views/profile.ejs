<!--profile pages (profile.ejs)-->
<!--Paris Ward, Lucas Moraes, Joshua Ethington, Parker Sandstrom-->
<!--This page will display participant information-->
<!--It will also display the participant milestones, donations, event registration, survey results-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      <%=participant.participant_first_name%>
      <%=participant.participant_last_name%>- Ella Rises
    </title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="icon" type="image/x-icon" href="/logo.ico" />
  </head>
  <body>
    <!-- Skip Navigation Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav>
      <div class="nav-container">
          <div class="logo">
              <a href="/"><img src="/images/logo.png" alt="Ella Rises Logo"> ELLA RISES</a>
          </div>
          <ul class="nav-links">
              <li><a href="/">Home</a></li>
              <li><a href="/about" class="selected-nav">About</a></li>
              <li><a href="/performance">Performance</a></li>
              <li><a href="/calendar">Calendar</a></li>
              <li><a href="/donate_now">Donate Now</a></li>

              <% if (isLoggedIn && userId) { %>
                  <li><a href="/profile/<%= userId %>">Profile</a></li>
              <% } %>

              <% if (role === "admin") { %>
                  <li class="dropdown">
                      <span class="dropdown-toggle">
                          <a href="#">Pages ‚ñæ</a>
                      </span>
                      <ul class="dropdown-menu">
                          <li><a href="/users">Users</a></li>
                          <li><a href="/participants">Participants</a></li>
                          <li><a href="/events">Events</a></li>
                          <li><a href="/event_registrations">Event Registrations</a></li>
                          <li><a href="/surveys">Surveys</a></li>
                          <li><a href="/milestones">Milestones</a></li>
                          <li><a href="/donations">Donations</a></li>
                      </ul>
                  </li>
              <% } %>

              <% if (isLoggedIn) { %>
                  <li><a href="/logout" class="login-btn">Logout</a></li>
              <% } else { %>
                  <li><a href="/login" class="login-btn">Login</a></li>
              <% } %>
          </ul>
      </div>
  </nav>

    <!-- Hero Section -->
    <section class="hero hero-compact">
      <div class="hero-content">
        <h1>
          <%= participant.participant_first_name %> <%=
          participant.participant_last_name %>
        </h1>
        <% if (participant.participant_role &&
        participant.participant_role.toLowerCase() !== 'participant') { %>
        <p class="hero-subtitle">
          <%= participant.participant_role.charAt(0).toUpperCase() +
          participant.participant_role.slice(1).toLowerCase() %>
        </p>
        <% } %>
      </div>
    </section>

    <!-- Main Content -->
    <main id="main-content">
    <div
      class="container"
      style="max-width: 1400px; margin-top: 2rem; margin-bottom: 4rem"
    >
      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button class="tab-btn active" data-tab="quickview">
          Quick View
        </button>
        <button class="tab-btn" data-tab="profile">
          Personal Information
        </button>
        <button class="tab-btn" data-tab="milestones">Milestones</button>
        <button class="tab-btn" data-tab="donations">Donations</button>
        <button class="tab-btn" data-tab="events">Event Registrations</button>
        <button class="tab-btn" data-tab="surveys">Survey Results</button>
      </div>

      <!-- Quick View Tab (Role-Based Content) -->
      <div id="quickview-tab" class="tab-content active">
        
        <!-- PARTICIPANT QUICK VIEW -->
        <% if (participant.participant_role && participant.participant_role.toLowerCase() === 'participant') { %>
          <!-- Welcome Card -->
          <div class="dashboard-welcome-card">
            <h2 class="dashboard-welcome-title">Welcome back, <%= participant.participant_first_name %>!</h2>
            <p class="dashboard-welcome-text">Here's what's happening with your Ella Rises journey.</p>
          </div>

          <!-- Dashboard Grid -->
          <div class="dashboard-grid">
            
            <!-- Quick Stats Card -->
            <div class="dashboard-card dashboard-stats-card">
              <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">Your Stats</h3>
              </div>
              <div class="dashboard-card-body">
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚Üë</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= upcomingEventsCount || 0 %></div>
                    <div class="dashboard-stat-label">Upcoming Events</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚úì</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= attendedEventsCount || 0 %></div>
                    <div class="dashboard-stat-label">Events Attended</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚òÖ</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= milestones ? milestones.length : 0 %></div>
                    <div class="dashboard-stat-label">Milestones Achieved</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚óâ</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= pendingSurveysCount || 0 %></div>
                    <div class="dashboard-stat-label">Surveys Pending</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="dashboard-card dashboard-actions-card">
              <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">Quick Actions</h3>
              </div>
              <div class="dashboard-card-body">
                <a href="/calendar" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚ñ∂</span>
                  <span class="dashboard-action-text">Browse Events</span>
                </a>
                <a href="/donate_now" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚ô•</span>
                  <span class="dashboard-action-text">Make a Donation</span>
                </a>
                <a href="/profile/<%= participant.participant_id %>?tab=milestones" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚òÖ</span>
                  <span class="dashboard-action-text">View Milestones</span>
                </a>
              </div>
            </div>

            <!-- Upcoming Events Card -->
            <div class="dashboard-card dashboard-full-width">
              <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">Your Upcoming Events</h3>
              </div>
              <div class="dashboard-card-body">
                <% if (upcomingEvents && upcomingEvents.length > 0) { %>
                  <div class="dashboard-event-list">
                    <% upcomingEvents.forEach(function(event) { %>
                      <div class="dashboard-event-item" onclick="showEventDetailsModal('<%= event.event_name.replace(/'/g, "\\'") %>', '<%= event.event_date ? new Date(event.event_date).toLocaleDateString() : "N/A" %>', '<%= event.event_start_time || "N/A" %>', '<%= event.event_end_time || "N/A" %>', '<%= event.event_location ? event.event_location.replace(/'/g, "\\'") : "N/A" %>', 'No additional details available.')">
                        <div class="dashboard-event-icon">‚ñ∂</div>
                        <div class="dashboard-event-info">
                          <div class="dashboard-event-name"><%= event.event_name %></div>
                          <div class="dashboard-event-date">
                            <%= event.event_date ? new Date(event.event_date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : 'Date TBD' %>
                            <% if (event.event_start_time) { %>
                              ‚Ä¢ <%= event.event_start_time %>
                            <% } %>
                          </div>
                        </div>
                        <div class="dashboard-event-arrow">‚Üí</div>
                      </div>
                    <% }); %>
                  </div>
                <% } else { %>
                  <div class="dashboard-empty-state">
                    <div class="dashboard-empty-icon">‚óã</div>
                    <p class="dashboard-empty-text">You haven't registered for any upcoming events yet.</p>
                    <a href="/calendar" class="btn btn-primary">Register for Events</a>
                  </div>
                <% } %>
              </div>
            </div>

            <!-- Pending Surveys Card -->
            <div class="dashboard-card dashboard-full-width">
              <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">Surveys Awaiting Your Feedback</h3>
              </div>
              <div class="dashboard-card-body">
                <% if (pendingSurveys && pendingSurveys.length > 0) { %>
                  <div class="dashboard-survey-list">
                    <% pendingSurveys.forEach(function(survey) { %>
                      <div class="dashboard-survey-item">
                        <div class="dashboard-survey-icon">‚óâ</div>
                        <div class="dashboard-survey-info">
                          <div class="dashboard-survey-name"><%= survey.event_name %></div>
                          <div class="dashboard-survey-date">
                            Event Date: <%= survey.event_date ? new Date(survey.event_date).toLocaleDateString() : 'N/A' %>
                          </div>
                        </div>
                        <a href="/add/survey_results?event_registration_id=<%= survey.event_registration_id %>&participant_id=<%= participant.participant_id %>&event_name=<%= encodeURIComponent(survey.event_name) %>&event_date=<%= survey.event_date %>" class="btn btn-primary btn-small">Complete Survey</a>
                      </div>
                    <% }); %>
                  </div>
                <% } else { %>
                  <div class="dashboard-empty-state">
                    <div class="dashboard-empty-icon">‚úì</div>
                    <p class="dashboard-empty-text">You're all caught up! No pending surveys at this time.</p>
                  </div>
                <% } %>
              </div>
            </div>

          </div>
        
        <!-- DONOR QUICK VIEW -->
        <% } else if (participant.participant_role && participant.participant_role.toLowerCase() === 'donor') { %>
          <!-- Welcome Card -->
          <div class="dashboard-welcome-card dashboard-welcome-donor">
            <h2 class="dashboard-welcome-title">Welcome back, <%= participant.participant_first_name %>!</h2>
            <p class="dashboard-welcome-text">Thank you for your generous support of Ella Rises.</p>
          </div>

          <!-- Dashboard Grid -->
          <div class="dashboard-grid">
            
            <!-- Personal Info Card -->
            <div class="dashboard-card">
              <div class="dashboard-card-header dashboard-card-header-donor">
                <h3 class="dashboard-card-title">Your Information</h3>
              </div>
              <div class="dashboard-card-body">
                <div class="profile-section-content">
                  <div class="profile-item">
                    <span class="profile-label">Email</span>
                    <span class="profile-value"><%= participant.participant_email || 'N/A' %></span>
                  </div>
                  <div class="profile-item">
                    <span class="profile-label">Phone</span>
                    <span class="profile-value"><%= participant.participant_phone || 'N/A' %></span>
                  </div>
                  <div class="profile-item">
                    <span class="profile-label">Location</span>
                    <span class="profile-value"><%= participant.participant_city || 'N/A' %>, <%= participant.participant_state || 'N/A' %></span>
                  </div>
                  <div class="profile-item" style="border-bottom: none;">
                    <span class="profile-label">Total Donations</span>
                    <span class="profile-value profile-value-donations">$<%= participant.Total_Donations ? participant.Total_Donations.toFixed(2) : '0.00' %></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="dashboard-card dashboard-actions-card">
              <div class="dashboard-card-header dashboard-card-header-donor">
                <h3 class="dashboard-card-title">Quick Actions</h3>
              </div>
              <div class="dashboard-card-body">
                <a href="/donate_now" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚ô•</span>
                  <span class="dashboard-action-text">Make a Donation</span>
                </a>
                <a href="/calendar" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚ñ∂</span>
                  <span class="dashboard-action-text">View Events</span>
                </a>
                <a href="/profile/<%= participant.participant_id %>?tab=donations" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">$</span>
                  <span class="dashboard-action-text">View Donation History</span>
                </a>
              </div>
            </div>

            <!-- Upcoming Events Card -->
            <div class="dashboard-card dashboard-full-width">
              <div class="dashboard-card-header dashboard-card-header-donor">
                <h3 class="dashboard-card-title">Upcoming Ella Rises Events</h3>
              </div>
              <div class="dashboard-card-body">
                <% if (allUpcomingEvents && allUpcomingEvents.length > 0) { %>
                  <div class="dashboard-event-list">
                    <% allUpcomingEvents.forEach(function(event) { %>
                      <div class="dashboard-event-item" onclick="showEventDetailsModal('<%= event.event_name.replace(/'/g, "\\'") %>', '<%= event.event_date ? new Date(event.event_date).toLocaleDateString() : "N/A" %>', '<%= event.event_start_time || "N/A" %>', '<%= event.event_end_time || "N/A" %>', '<%= event.event_location ? event.event_location.replace(/'/g, "\\'") : "N/A" %>', 'No additional details available.')">
                        <div class="dashboard-event-icon">‚ñ∂</div>
                        <div class="dashboard-event-info">
                          <div class="dashboard-event-name"><%= event.event_name %></div>
                          <div class="dashboard-event-date">
                            <%= event.event_date ? new Date(event.event_date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : 'Date TBD' %>
                            <% if (event.event_start_time) { %>
                              ‚Ä¢ <%= event.event_start_time %>
                            <% } %>
                          </div>
                        </div>
                        <div class="dashboard-event-arrow">‚Üí</div>
                      </div>
                    <% }); %>
                  </div>
                <% } else { %>
                  <div class="dashboard-empty-state">
                    <div class="dashboard-empty-icon">‚óã</div>
                    <p class="dashboard-empty-text">No upcoming events scheduled at this time.</p>
                  </div>
                <% } %>
              </div>
            </div>

          </div>

        <!-- ADMIN QUICK VIEW -->
        <% } else if (participant.participant_role && participant.participant_role.toLowerCase() === 'admin') { %>
          <!-- Welcome Card -->
          <div class="dashboard-welcome-card dashboard-welcome-admin">
            <h2 class="dashboard-welcome-title">Welcome back, <%= participant.participant_first_name %>!</h2>
            <p class="dashboard-welcome-text">Here's your Ella Rises administrative overview.</p>
          </div>

          <!-- Dashboard Grid -->
          <div class="dashboard-grid">
            
            <!-- System Stats Card -->
            <div class="dashboard-card dashboard-stats-card">
              <div class="dashboard-card-header dashboard-card-header-admin">
                <h3 class="dashboard-card-title">System Overview</h3>
              </div>
              <div class="dashboard-card-body">
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚óè</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= participantCount || 0 %></div>
                    <div class="dashboard-stat-label">Participants</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚ô•</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= sponsorCount || 0 %></div>
                    <div class="dashboard-stat-label">Sponsors</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚ñ∂</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= allUpcomingEventsCount || 0 %></div>
                    <div class="dashboard-stat-label">Upcoming Events</div>
                  </div>
                </div>
                <div class="dashboard-stat-item">
                  <span class="dashboard-stat-icon">‚úì</span>
                  <div class="dashboard-stat-info">
                    <div class="dashboard-stat-value"><%= totalRegistrations || 0 %></div>
                    <div class="dashboard-stat-label">Total Registrations</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="dashboard-card dashboard-actions-card">
              <div class="dashboard-card-header dashboard-card-header-admin">
                <h3 class="dashboard-card-title">Quick Actions</h3>
              </div>
              <div class="dashboard-card-body">
                <a href="/add/participants" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">+</span>
                  <span class="dashboard-action-text">Add Participant</span>
                </a>
                <a href="/add/events" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">+</span>
                  <span class="dashboard-action-text">Add Event</span>
                </a>
                <a href="/calendar" class="dashboard-action-btn">
                  <span class="dashboard-action-icon">‚ñ∂</span>
                  <span class="dashboard-action-text">View Calendar</span>
                </a>
              </div>
            </div>

            <!-- Manage Tables Card -->
            <div class="dashboard-card dashboard-full-width">
              <div class="dashboard-card-header dashboard-card-header-admin">
                <h3 class="dashboard-card-title">Manage Data</h3>
              </div>
              <div class="dashboard-card-body">
                <div class="dashboard-table-links">
                  <a href="/participants" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚óè</span>
                    <span class="dashboard-table-text">Participants</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                  <a href="/events" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚ñ∂</span>
                    <span class="dashboard-table-text">Events</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                  <a href="/event_registrations" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚úì</span>
                    <span class="dashboard-table-text">Event Registrations</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                  <a href="/surveys" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚óâ</span>
                    <span class="dashboard-table-text">Surveys</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                  <a href="/milestones" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚òÖ</span>
                    <span class="dashboard-table-text">Milestones</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                  <a href="/donations" class="dashboard-table-link">
                    <span class="dashboard-table-icon">‚ô•</span>
                    <span class="dashboard-table-text">Donations</span>
                    <span class="dashboard-table-arrow">‚Üí</span>
                  </a>
                </div>
              </div>
            </div>

            <!-- Upcoming Events Card -->
            <div class="dashboard-card dashboard-full-width">
              <div class="dashboard-card-header dashboard-card-header-admin">
                <h3 class="dashboard-card-title">Upcoming Events</h3>
              </div>
              <div class="dashboard-card-body">
                <% if (allUpcomingEvents && allUpcomingEvents.length > 0) { %>
                  <div class="dashboard-event-list">
                    <% allUpcomingEvents.forEach(function(event) { %>
                      <div class="dashboard-event-item" onclick="showEventDetailsModal('<%= event.event_name.replace(/'/g, "\\'") %>', '<%= event.event_date ? new Date(event.event_date).toLocaleDateString() : "N/A" %>', '<%= event.event_start_time || "N/A" %>', '<%= event.event_end_time || "N/A" %>', '<%= event.event_location ? event.event_location.replace(/'/g, "\\'") : "N/A" %>', 'No additional details available.')">
                        <div class="dashboard-event-icon">‚ñ∂</div>
                        <div class="dashboard-event-info">
                          <div class="dashboard-event-name"><%= event.event_name %></div>
                          <div class="dashboard-event-date">
                            <%= event.event_date ? new Date(event.event_date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : 'Date TBD' %>
                            <% if (event.event_start_time) { %>
                              ‚Ä¢ <%= event.event_start_time %>
                            <% } %>
                          </div>
                        </div>
                        <div class="dashboard-event-arrow">‚Üí</div>
                      </div>
                    <% }); %>
                  </div>
                <% } else { %>
                  <div class="dashboard-empty-state">
                    <div class="dashboard-empty-icon">‚óã</div>
                    <p class="dashboard-empty-text">No upcoming events scheduled at this time.</p>
                  </div>
                <% } %>
              </div>
            </div>

          </div>
        <% } %>
      </div>

      <!-- Personal Information Tab -->
      <div id="profile-tab" class="tab-content">
        <!-- Detailed Information -->
        <div class="profile-sections-grid">
          <!-- Location Information -->
          <div class="card profile-section-card">
            <div class="card-header">
              <h3 class="profile-section-title">Location</h3>
            </div>
            <div class="card-body">
              <div class="profile-section-content">
                <div class="profile-item">
                  <label class="profile-label">City</label>
                  <div class="profile-value">
                    <%= participant.participant_city || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">State</label>
                  <div class="profile-value">
                    <%= participant.participant_state || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">ZIP Code</label>
                  <div class="profile-value">
                    <%= participant.participant_zip || 'None' %>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Contact Information -->
          <div class="card profile-section-card">
            <div class="card-header">
              <h3 class="profile-section-title">Contact Information</h3>
            </div>
            <div class="card-body">
              <div class="profile-section-content">
                <div class="profile-item">
                  <label class="profile-label">Phone</label>
                  <div class="profile-value">
                    <%= participant.participant_phone || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">Email</label>
                  <div class="profile-value">
                    <%= participant.participant_email || 'None' %>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Login Information -->
          <div class="card profile-section-card">
            <div class="card-header">
              <h3 class="profile-section-title">Login Information</h3>
            </div>
            <div class="card-body">
              <div class="profile-section-content">
                <div class="profile-item">
                  <label class="profile-label">Username</label>
                  <div class="profile-value">
                    <%= participant.participant_username || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">Role</label>
                  <div class="profile-value">
                    <%= participant.participant_role || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">Participant ID</label>
                  <div class="profile-value">
                    #<%= participant.participant_id %>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Personal Details -->
          <div class="card profile-section-card">
            <div class="card-header">
              <h3 class="profile-section-title">Personal Details</h3>
            </div>
            <div class="card-body">
              <div class="profile-section-content">
                <div class="profile-item">
                  <label class="profile-label">Date of Birth</label>
                  <div class="profile-value">
                    <%= participant.participant_dob ? new
                    Date(participant.participant_dob).toLocaleDateString() :
                    'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">School/Employer</label>
                  <div class="profile-value">
                    <%= participant.participant_school_or_employer || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">Field of Interest</label>
                  <div class="profile-value">
                    <%= participant.participant_field_of_interest || 'None' %>
                  </div>
                </div>
                <div class="profile-item">
                  <label class="profile-label">Donation Totals</label>
                  <div
                    class="profile-value <%= participant.Total_Donations > 0 ? 'profile-value-donations' : '' %>"
                  >
                    $<%= participant.Total_Donations ?
                    participant.Total_Donations.toFixed(2) : '0.00' %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions">
          <button onclick="editProfile()" class="btn btn-primary">Edit Profile</button>
          <button onclick="showDeleteAccountModal()" class="btn btn-danger">
            Delete Account
          </button>
        </div>
      </div>

      <!-- Milestones Tab -->
      <div id="milestones-tab" class="tab-content">
        <div class="table-container">
          <!--Table Header-->
          <div class="table-header">
            <h2 class="table-title">Milestones</h2>
            <div class="table-actions">
              <button onclick="addMilestone()" class="btn btn-add">Add Milestone</button>
              <button
                id="milestones-edit-btn"
                class="btn btn-secondary"
                style="display: none"
              >
                Edit Selected
              </button>
              <button
                id="milestones-delete-btn"
                class="btn btn-danger"
                style="display: none"
              >
                Delete Selected
              </button>
            </div>
          </div>
          <!--Table-->
          <% if (milestones && milestones.length > 0) { %>
          <div>
            <table>
              <!--Table Column Names-->
              <thead>
                <tr>
                  <th><input type="checkbox" id="milestones-select-all" /></th>
                  <th>Title</th>
                  <th>Category</th>
                  <th>Date</th>
                </tr>
              </thead>
              <!--Table Rows-->
              <tbody>
                <% milestones.forEach(function(milestone) { %>
                <tr>
                  <td>
                    <input
                      type="checkbox"
                      class="row-checkbox milestones-checkbox"
                      data-id="<%= milestone.milestone_id %>"
                    />
                  </td>
                  <td><%= milestone.milestone_title %></td>
                  <td>
                    <span class="badge badge-primary"
                      ><%= milestone.milestone_category || 'General' %></span
                    >
                  </td>
                  <td>
                    <%= milestone.milestone_date ? new
                    Date(milestone.milestone_date).toLocaleDateString() : 'N/A'
                    %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <!--If no rows: -->
          <% } else { %>
          <div class="empty-state">
            <h2>No Milestones Yet</h2>
            <p>Start tracking achievements by adding a milestone.</p>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Donations Tab -->
      <div id="donations-tab" class="tab-content">
        <div class="table-container">
          <!--Table Header-->
          <div class="table-header">
            <h2 class="table-title">Donations</h2>
            <div class="table-actions">
              <button onclick="makeDonation()" class="btn btn-add">Make a Donation</button>
            </div>
          </div>
          <!--Table-->
          <% if (donations && donations.length > 0) { %>
          <div>
            <table>
              <!--Table column titles-->
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <!--Table row entries-->
              <tbody>
                <% donations.forEach(function(donation) { %>
                <tr>
                  <td>
                    <%= donation.donation_date ? new
                    Date(donation.donation_date).toLocaleDateString() : 'N/A' %>
                  </td>
                  <td class="text-success" style="font-weight: 600">
                    $<%= donation.donation_amount ?
                    donation.donation_amount.toFixed(2) : '0.00' %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <!--If empty:-->
          <% } else { %>
          <div class="empty-state">
            <h2>No Donations</h2>
            <p>No donation records found for this participant.</p>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Event Registrations Tab -->
      <div id="events-tab" class="tab-content">
        <div class="table-container">
          <!--Table Header-->
          <div class="table-header">
            <h2 class="table-title">Event Registrations</h2>
            <div class="table-actions">
              <button onclick="registerForEvent()" class="btn btn-add">
                Register for an Event
              </button>
            </div>
          </div>
          <!--Table-->
          <% if (eventRegistrations && eventRegistrations.length > 0) { %>
          <div>
            <table>
              <!--Table Column Names-->
              <thead>
                <tr>
                  <th>Event Name</th>
                  <th>Event Date</th>
                  <th>Start Time</th>
                  <th>End Time</th>
                  <th>Location</th>
                  <th>Status</th>
                  <th>Attended</th>
                  <th>Registered On</th>
                  <th>Check-In</th>
                </tr>
              </thead>
              <!--Table row entries-->
              <tbody>
                <% eventRegistrations.forEach(function(reg) { %>
                <tr>
                  <td><%= reg.event_name %></td>
                  <td><%= reg.event_date ? new Date(reg.event_date).toLocaleDateString() : 'N/A' %></td>
                  <td><%= reg.event_start_time || 'N/A' %></td>
                  <td><%= reg.event_end_time || 'N/A' %></td>
                  <td><%= reg.event_location || 'N/A' %></td>
                  <td>
                    <span
                      class="badge <%= reg.registration_status === 'confirmed' || reg.registration_status === 'attended' ? 'badge-success' : reg.registration_status === 'registered' ? 'badge-warning' : 'badge-secondary' %>"
                      ><%= reg.registration_status || 'Pending' %></span
                    >
                  </td>
                  <td>
                    <%= reg.registration_attended_flag ? '‚úì Yes' : '‚úó No' %>
                  </td>
                  <td>
                    <%= reg.registration_created_at_date ? new
                    Date(reg.registration_created_at_date).toLocaleDateString()
                    : 'N/A' %>
                  </td>
                  <td>
                    <%= reg.registration_check_in_date ? new
                    Date(reg.registration_check_in_date).toLocaleDateString() :
                    'N/A' %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
            <!--If empty:-->
          </div>
          <% } else { %>
          <div class="empty-state">
            <h2>No Event Registrations</h2>
            <p>This participant hasn't registered for any events yet.</p>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Survey Results Tab -->
      <div id="surveys-tab" class="tab-content">
        <div class="table-container">
          <!--table header-->
          <div class="table-header">
            <h2 class="table-title">Survey Results</h2>
            <div class="table-actions">
              <button
                id="surveys-edit-btn"
                class="btn btn-secondary"
                style="display: none"
              >
                Edit Selected
              </button>
              <button
                id="surveys-delete-btn"
                class="btn btn-danger"
                style="display: none"
              >
                Delete Selected
              </button>
            </div>
          </div>
          <% if (surveys && surveys.length > 0) { %>
          <div>
            <table>
              <!--table column names-->
              <thead>
                <tr>
                  <th><input type="checkbox" id="surveys-select-all" /></th>
                  <th>Event Name</th>
                  <th>Event Date</th>
                  <th>Satisfaction</th>
                  <th>Usefulness</th>
                  <th>Instructor</th>
                  <th>Recommendation</th>
                  <th>Overall</th>
                  <th>NPS Bucket</th>
                  <th>Comments</th>
                  <th>Submitted</th>
                </tr>
              </thead>
              <!--table row entries-->
              <tbody>
                <% surveys.forEach(function(survey) { %>
                <tr>
                  <td>
                    <input
                      type="checkbox"
                      class="row-checkbox surveys-checkbox"
                      data-id="<%= survey.survey_id %>"
                    />
                  </td>
                  <td><%= survey.event_name %></td>
                  <td><%= survey.event_date ? new Date(survey.event_date).toLocaleDateString() : 'N/A' %></td>
                  <td><%= survey.survey_satisfaction_score || 'N/A' %></td>
                  <td><%= survey.survey_usefulness_score || 'N/A' %></td>
                  <td><%= survey.survey_instructor_score || 'N/A' %></td>
                  <td><%= survey.survey_recommendation_score || 'N/A' %></td>
                  <td class="text-primary" style="font-weight: 600">
                    <%= survey.survey_overall_score || 'N/A' %>
                  </td>
                  <td>
                    <% if (survey.survey_nps_bucket) { %>
                    <span
                      class="badge <%= survey.survey_nps_bucket === 'Promoter' ? 'badge-success' : survey.survey_nps_bucket === 'Passive' ? 'badge-warning' : 'badge-danger' %>"
                    >
                      <%= survey.survey_nps_bucket %>
                    </span>
                    <% } else { %> N/A <% } %>
                  </td>
                  <td style="text-align: center;">
                    <% if (survey.survey_comments && survey.survey_comments.trim() !== '') { %>
                      <button class="btn btn-small view-comments-btn" 
                              data-comments="<%= survey.survey_comments.replace(/"/g, '&quot;').replace(/'/g, '&#39;') %>"
                              data-event="<%= survey.event_name %>"
                              style="padding: 0.3rem 0.6rem; font-size: 0.9rem;">
                          <span class="material-symbols-outlined">mode_comment</span>
                      </button>
                    <% } %>
                  </td>
                  <td>
                    <%= survey.submission_date ? new
                    Date(survey.submission_date).toLocaleDateString() : 'N/A' %>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <!--if empty:-->
          <% } else { %>
          <div class="empty-state">
            <h2>No Survey Results</h2>
            <p>No survey responses found for this participant.</p>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="deleteAccountModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Confirm Account Deletion</h3>
          <button class="modal-close" onclick="closeDeleteAccountModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p style="font-size: 1.1rem; color: #d32f2f; font-weight: 600; margin-bottom: 1rem;">
            ‚ö†Ô∏è Warning: This action is permanent
          </p>
          <p>
            Are you sure you want to delete your account? This will permanently remove:
          </p>
          <ul style="margin: 1rem 0; padding-left: 2rem; text-align: left;">
            <li>Your personal information</li>
            <li>All your milestones</li>
            <li>Your donation history</li>
            <li>Your event registrations</li>
            <li>Your survey responses</li>
          </ul>
          <p style="font-weight: 600; color: #d32f2f;">
            This action cannot be undone. You will be logged out immediately.
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeDeleteAccountModal()">
            Cancel
          </button>
          <button id="confirmDeleteAccountBtn" class="btn btn-danger">Yes, Delete My Account</button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal (for other tabs) -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Confirm Deletion</h3>
          <button class="modal-close" onclick="closeDeleteModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete the selected item(s)? This action
            cannot be undone.
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeDeleteModal()">
            Cancel
          </button>
          <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Comments Modal -->
    <div id="commentsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Survey Comments</h3>
          <button class="modal-close" onclick="closeCommentsModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p id="commentsEventInfo" style="margin-bottom: 0.5rem; color: #666; font-weight: 600;"></p>
          <p id="commentsText" style="font-size: 1rem; color: #333; white-space: pre-wrap; line-height: 1.6;"></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeCommentsModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Event Details Modal (for Quick View) -->
    <div id="eventDetailsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header" style="background-color: var(--powder-blue);">
          <h3 class="modal-title" id="eventDetailsTitle" style="color: white;"></h3>
          <button class="modal-close" onclick="closeEventDetailsModal()" style="color: white;">&times;</button>
        </div>
        <div class="modal-body">
          <div class="event-modal-detail">
            <span class="event-modal-label">Date</span>
            <div class="event-modal-value" id="eventDetailsDate"></div>
          </div>
          <div class="event-modal-detail">
            <span class="event-modal-label">Time</span>
            <div class="event-modal-value" id="eventDetailsTime"></div>
          </div>
          <div class="event-modal-detail">
            <span class="event-modal-label">Location</span>
            <div class="event-modal-value" id="eventDetailsLocation"></div>
          </div>
          <div class="event-modal-detail">
            <span class="event-modal-label">Description</span>
            <div class="event-modal-value" id="eventDetailsDescription"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeEventDetailsModal()">Close</button>
        </div>
      </div>
    </div>
    </main>

    <!--Footer-->
    <footer>
        <p>&copy; 2025 Ella Rises. All Rights Reserved.</p>
        <p class="footer-subtext">Making a difference, one woman at a time.</p>

        <div class="custom-language-selector">
            <button class="language-dropdown-btn" onclick="toggleLanguageDropdown()">
                <span id="currentLanguage">
                    <% if (language === 'es') { %>üåê Espa√±ol
                    <% } else if (language === 'fr') { %>üåê Fran√ßais
                    <% } else if (language === 'de') { %>üåê Deutsch
                    <% } else if (language === 'pt') { %>üåê Portugu√™s
                    <% } else if (language === 'ar') { %>üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                    <% } else if (language === 'zh-CN') { %>üåê ‰∏≠Êñá
                    <% } else if (language === 'ja') { %>üåê Êó•Êú¨Ë™û
                    <% } else if (language === 'ko') { %>üåê ÌïúÍµ≠Ïñ¥
                    <% } else { %>üåê English <% } %>
                </span>
                <span class="dropdown-arrow">‚ñæ</span>
            </button>
            <div class="language-dropdown-menu" id="languageDropdown">
                <a href="#" onclick="changeLanguage('en'); return false;">English</a>
                <a href="#" onclick="changeLanguage('es'); return false;">Espa√±ol</a>
                <a href="#" onclick="changeLanguage('fr'); return false;">Fran√ßais</a>
                <a href="#" onclick="changeLanguage('de'); return false;">Deutsch</a>
                <a href="#" onclick="changeLanguage('pt'); return false;">Portugu√™s</a>
                <a href="#" onclick="changeLanguage('ar'); return false;">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
                <a href="#" onclick="changeLanguage('zh-CN'); return false;">‰∏≠Êñá</a>
                <a href="#" onclick="changeLanguage('ja'); return false;">Êó•Êú¨Ë™û</a>
                <a href="#" onclick="changeLanguage('ko'); return false;">ÌïúÍµ≠Ïñ¥</a>
            </div>
        </div>

        <div id="google_translate_element" style="display:none;"></div>

        <script>
            const LANGUAGE_NAMES = {
                'en': 'üåê English',
                'es': 'üåê Espa√±ol',
                'fr': 'üåê Fran√ßais',
                'de': 'üåê Deutsch',
                'pt': 'üåê Portugu√™s',
                'ar': 'üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
                'zh-CN': 'üåê ‰∏≠Êñá',
                'ja': 'üåê Êó•Êú¨Ë™û',
                'ko': 'üåê ÌïúÍµ≠Ïñ¥'
            };

            // From server-side session (res.locals.language)
            const SESSION_LANGUAGE = '<%= language || "en" %>';

            // Initialize Google Translate widget ‚Äì no extra logic here
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({
                    pageLanguage: 'en',
                    includedLanguages: 'en,es,fr,de,pt,ar,zh-CN,ja,ko',
                    autoDisplay: false
                }, 'google_translate_element');
            }

            function getGoogTransLang() {
                // Looks for cookie like: googtrans=/auto/es
                const match = document.cookie.match(/(?:^|;)\s*googtrans=\/auto\/([^;]+)/);
                return match ? match[1] : null;
            }

            function setLanguageLabel(lang) {
                const el = document.getElementById('currentLanguage');
                if (!el) return;
                el.textContent = LANGUAGE_NAMES[lang] || LANGUAGE_NAMES['en'];
            }

            function applyLanguage(lang, isInit) {
                const combo = document.querySelector('.goog-te-combo');
                if (!combo) {
                    // Wait for Google widget to finish rendering
                    setTimeout(() => applyLanguage(lang, isInit), 200);
                    return;
                }

                combo.value = lang;
                combo.dispatchEvent(new Event('change'));
                setLanguageLabel(lang);

                if (!isInit) {
                    // Persist to your session on the server
                    fetch('/set-language', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lang })
                    }).catch(() => {});
                    // Optional: localStorage helper if you want it
                    localStorage.setItem('selectedLanguage', lang);
                    toggleLanguageDropdown(false);
                }
            }

            function changeLanguage(lang) {
                applyLanguage(lang, false);
            }

            function toggleLanguageDropdown(forceClose) {
                const dropdown = document.getElementById('languageDropdown');
                if (!dropdown) return;
                if (forceClose === false) {
                    dropdown.classList.remove('show');
                } else {
                    dropdown.classList.toggle('show');
                }
            }

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.custom-language-selector')) {
                    toggleLanguageDropdown(false);
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                // Make sure the label matches whatever we think the language is
                setLanguageLabel(SESSION_LANGUAGE);

                const cookieLang = getGoogTransLang();
                const storedLang = localStorage.getItem('selectedLanguage');

                // Priority: Google cookie > session > localStorage
                const preferred =
                    cookieLang ||
                    (SESSION_LANGUAGE && SESSION_LANGUAGE !== 'undefined' ? SESSION_LANGUAGE : null) ||
                    storedLang ||
                    'en';

                // If preferred is English, just leave as-is (no translate flicker)
                if (preferred === 'en') {
                    setLanguageLabel('en');
                    return;
                }

                // Apply preferred language once widget is ready
                setTimeout(() => applyLanguage(preferred, true), 500);
            });
        </script>

        <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    </footer>


    <script>
      const participantId = <%- JSON.stringify(participant.participant_id) %>;

      // Tab Switching
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");

      tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const tabName = button.getAttribute("data-tab");

          // Remove active class from all buttons and contents
          tabButtons.forEach((btn) => btn.classList.remove("active"));
          tabContents.forEach((content) => content.classList.remove("active"));

          // Add active class to clicked button and corresponding content
          button.classList.add("active");
          document.getElementById(`${tabName}-tab`).classList.add("active");
        });
      });

      // Check if URL has a tab parameter and switch to that tab
      window.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const tabParam = urlParams.get('tab');
        
        if (tabParam) {
          // Find the button with matching data-tab attribute
          const targetButton = document.querySelector(`[data-tab="${tabParam}"]`);
          
          if (targetButton) {
            // Remove active class from all
            tabButtons.forEach((btn) => btn.classList.remove("active"));
            tabContents.forEach((content) => content.classList.remove("active"));
            
            // Add active class to target
            targetButton.classList.add("active");
            document.getElementById(`${tabParam}-tab`).classList.add("active");
            
            // Scroll to top of page
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        }
      });

      // Navigation Dropdown handling
      let dropdownTimeout;
      const dropdown = document.querySelector(".dropdown");
      const dropdownMenu = document.querySelector(".dropdown-menu");

      if (dropdown && dropdownMenu) {
        dropdown.addEventListener("mouseenter", function () {
          clearTimeout(dropdownTimeout);
          dropdownMenu.style.display = "block";
        });

        dropdown.addEventListener("mouseleave", function () {
          dropdownTimeout = setTimeout(function () {
            dropdownMenu.style.display = "none";
          }, 200);
        });

        dropdownMenu.addEventListener("mouseenter", function () {
          clearTimeout(dropdownTimeout);
          dropdownMenu.style.display = "block";
        });

        dropdownMenu.addEventListener("mouseleave", function () {
          dropdownTimeout = setTimeout(function () {
            dropdownMenu.style.display = "none";
          }, 200);
        });
      }

      // Navigation functions for buttons
      function editProfile() {
        window.location.href = `/profile-edit/participants/${participantId}`;
      }

      function addMilestone() {
        window.location.href = `/add/milestones/${participantId}`;
      }

      function makeDonation() {
        window.location.href = '/donate_now';
      }

      function registerForEvent() {
        window.location.href = '/calendar';
      }

      // Delete Account Modal Functions
      function showDeleteAccountModal() {
        document.getElementById('deleteAccountModal').classList.add('active');
      }

      function closeDeleteAccountModal() {
        document.getElementById('deleteAccountModal').classList.remove('active');
      }

      // Delete Account Confirmation
      document.getElementById('confirmDeleteAccountBtn').addEventListener('click', async function() {
        try {
          const response = await fetch(`/profile-delete/participants/${participantId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          const result = await response.json();

          if (result.success) {
            // If there's a redirect URL (for account deletion), go there
            if (result.redirect) {
              window.location.href = result.redirect;
            } else {
              // Otherwise just reload the page
              window.location.reload();
            }
          } else {
            alert('Error deleting account. Please try again.');
            closeDeleteAccountModal();
          }
        } catch (err) {
          console.error('Error deleting account:', err);
          alert('There was a problem deleting your account.');
          closeDeleteAccountModal();
        }
      });

      // Comments Modal Functions
      function showCommentsModal(comments, eventName) {
        document.getElementById('commentsEventInfo').textContent = eventName;
        document.getElementById('commentsText').textContent = comments;
        document.getElementById('commentsModal').classList.add('active');
      }

      function closeCommentsModal() {
        document.getElementById('commentsModal').classList.remove('active');
      }

      // Event Details Modal Functions (for Quick View)
      function showEventDetailsModal(name, date, startTime, endTime, location, description) {
        document.getElementById('eventDetailsTitle').textContent = name;
        document.getElementById('eventDetailsDate').textContent = date;
        document.getElementById('eventDetailsTime').textContent = `${startTime} - ${endTime}`;
        document.getElementById('eventDetailsLocation').textContent = location;
        document.getElementById('eventDetailsDescription').textContent = description;
        document.getElementById('eventDetailsModal').classList.add('active');
      }

      function closeEventDetailsModal() {
        document.getElementById('eventDetailsModal').classList.remove('active');
      }

      // View Comments buttons
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.view-comments-btn').forEach(button => {
          button.addEventListener('click', function() {
            const comments = this.getAttribute('data-comments');
            const event = this.getAttribute('data-event');
            showCommentsModal(comments, event);
          });
        });
      });

      // Checkbox management for each table
      function setupCheckboxes(tablePrefix) {
        const selectAll = document.getElementById(`${tablePrefix}-select-all`);
        const checkboxes = document.querySelectorAll(
          `.${tablePrefix}-checkbox`
        );
        const editBtn = document.getElementById(`${tablePrefix}-edit-btn`);
        const deleteBtn = document.getElementById(`${tablePrefix}-delete-btn`);

        if (!selectAll || !checkboxes.length) return;

        // Select all functionality
        selectAll.addEventListener("change", function () {
          checkboxes.forEach((cb) => (cb.checked = this.checked));
          updateButtons(tablePrefix);
        });

        // Individual checkbox functionality
        checkboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            updateButtons(tablePrefix);
            updateSelectAll(tablePrefix);
          });
        });

        // Edit button functionality (uses profile-specific routes)
        if (editBtn) {
          editBtn.addEventListener("click", function () {
            const selectedIds = Array.from(checkboxes)
              .filter((cb) => cb.checked)
              .map((cb) => cb.getAttribute("data-id"));

            if (selectedIds.length === 1) {
              // Map UI prefixes to actual DB table names
              const tableNameMap = {
                milestones: "milestones",
                donations: "donations",
                events: "event_registrations",
                surveys: "survey_results"
              };

              const tableName = tableNameMap[tablePrefix] || tablePrefix;
              window.location.href = `/profile-edit/${tableName}/${selectedIds[0]}`;
            } else {
              alert("Please select exactly one item to edit.");
            }
          });
        }

        // Delete button functionality (uses profile-specific routes)
        if (deleteBtn) {
          deleteBtn.addEventListener("click", function () {
            const selectedIds = Array.from(checkboxes)
              .filter((cb) => cb.checked)
              .map((cb) => cb.getAttribute("data-id"));

            if (selectedIds.length > 0) {
              // Map UI prefixes to actual DB table names
              const tableNameMap = {
                milestones: "milestones",
                donations: "donations",
                events: "event_registrations",
                surveys: "survey_results"
              };

              const tableName = tableNameMap[tablePrefix] || tablePrefix;
              showDeleteModal(tableName, selectedIds);
            }
          });
        }
      }

      function updateButtons(tablePrefix) {
        const checkboxes = document.querySelectorAll(
          `.${tablePrefix}-checkbox`
        );
        const checkedCount = Array.from(checkboxes).filter(
          (cb) => cb.checked
        ).length;
        const editBtn = document.getElementById(`${tablePrefix}-edit-btn`);
        const deleteBtn = document.getElementById(`${tablePrefix}-delete-btn`);

        if (editBtn && deleteBtn) {
          if (checkedCount > 0) {
            editBtn.style.display = "inline-block";
            deleteBtn.style.display = "inline-block";
          } else {
            editBtn.style.display = "none";
            deleteBtn.style.display = "none";
          }
        }
      }

      function updateSelectAll(tablePrefix) {
        const selectAll = document.getElementById(`${tablePrefix}-select-all`);
        const checkboxes = document.querySelectorAll(
          `.${tablePrefix}-checkbox`
        );
        const allChecked = Array.from(checkboxes).every((cb) => cb.checked);
        const someChecked = Array.from(checkboxes).some((cb) => cb.checked);

        if (selectAll) {
          selectAll.checked = allChecked;
          selectAll.indeterminate = !allChecked && someChecked;
        }
      }

      // Delete modal functionality (for other tabs)
      let currentDeleteType = "";
      let currentDeleteIds = [];

      function showDeleteModal(type, ids) {
        currentDeleteType = type;
        currentDeleteIds = ids;
        document.getElementById("deleteModal").classList.add("active");
      }

      function closeDeleteModal() {
        document.getElementById("deleteModal").classList.remove("active");
        currentDeleteType = "";
        currentDeleteIds = [];
      }

      // Confirm delete for other tabs (uses profile-specific routes)
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener("click", async function () {
          if (!currentDeleteType || !currentDeleteIds.length) {
            closeDeleteModal();
            return;
          }

          try {
            // Fire one POST per ID using profile-specific delete route
            const responses = await Promise.all(
              currentDeleteIds.map((id) =>
                fetch(`/profile-delete/${currentDeleteType}/${id}`, {
                  method: "POST",
                })
              )
            );

            const allOk = responses.every((r) => r.ok);

            if (allOk) {
              // Map table names to tab names for redirect
              const tabMap = {
                milestones: 'milestones',
                donations: 'donations',
                event_registrations: 'events',
                survey_results: 'surveys'
              };

              const tab = tabMap[currentDeleteType] || 'profile';
              // Reload page with current tab
              window.location.href = `/profile/${participantId}?tab=${tab}`;
            } else {
              alert(
                "One or more deletions failed. Check the server logs for details."
              );
            }
          } catch (err) {
            console.error("Error deleting records:", err);
            alert("There was a problem deleting the records.");
          } finally {
            closeDeleteModal();
          }
        });
      }

      // Initialize checkboxes for all tables
      setupCheckboxes("milestones");
      setupCheckboxes("surveys");
    </script>
  </body>
</html>
